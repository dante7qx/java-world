<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!-- This file was generated by Data Model Tool See <a href="http://www.hna.net/dmt/schema">http://www.hna.net/dmt/schema</a> 
	Copyright (c) 2012 epolleo.com All rights reserved. Att.xml Date: 2012-08-14 -->
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "sql-map-2.dtd">
<sqlMap namespace="AttBean">
	<typeAlias alias="attBean" type="com.epolleo.pub.att.bean.AttBean" />
	<resultMap id="attResult" class="attBean">
		<result property="id" column="Id" />
		<result property="lotId" column="LotId" />
		<result property="type" column="Type" />
		<result property="description" column="Description" />
		<result property="path" column="Path" />
		<result property="updateBy" column="UpdateBy" />
		<result property="updateByUserName" column="UpdateByUserName" />
		<result property="updateDate" column="UpdateDate" />
	</resultMap>
	<!-- 分页查询 -->
	<select id="queryAttPage" resultMap="attResult" parameterClass="map">
		SELECT
		t.Id,
		t.LotId,
		t.Type,
		t.Description,
		t.Path,
		t.UpdateBy,
		IFNULL(u.USER_NAME, t.UpdateBy) AS UpdateByUserName,
		t.UpdateDate
		FROM
		P_Att t
		LEFT JOIN BP_USER u
		ON
		t.UpdateBy = u.USER_ID
		<dynamic prepend=" WHERE ">
			<isPropertyAvailable prepend=" AND "
				removeFirstPrepend="true" property="lotId">
				t.LotId = #lotId#
			</isPropertyAvailable>
		</dynamic>
	</select>
	<!-- 查询所有记录 -->
	<select id="queryAttList" resultMap="attResult" parameterClass="map">
		SELECT
		t.Id,
		t.LotId,
		t.Type,
		t.Description,
		t.Path,
		t.UpdateBy,
		IFNULL(u.USER_NAME, t.UpdateBy) AS UpdateByUserName,
		t.UpdateDate
		FROM
		P_Att t
		LEFT JOIN BP_USER u
		ON
		t.UpdateBy = u.USER_ID
	</select>
	<select id="queryBylotId" resultMap="attResult">
		SELECT
		t.Id,
		t.LotId,
		t.Type,
		t.Description,
		t.Path,
		t.UpdateBy,
		IFNULL(u.USER_NAME, t.UpdateBy) AS UpdateByUserName,
		t.UpdateDate
		FROM
		P_Att t
		LEFT JOIN BP_USER u
		ON
		t.UpdateBy = u.USER_ID
		WHERE
		t.LotId = #lotId#
		ORDER BY t.UpdateDate DESC
	</select>
	<select id="queryAttByLotIds" resultClass="com.epolleo.pub.att.bean.AttBean">
		SELECT
		t.Id,
		t.LotId,
		t.Type,
		t.Description,
		t.Path,
		t.UpdateBy,
		IFNULL(u.USER_NAME, t.UpdateBy) AS UpdateByUserName,
		t.UpdateDate
		FROM
		P_Att t
		LEFT JOIN BP_USER u ON t.UpdateBy = u.USER_ID
		<dynamic prepend=" where ">
			<isPropertyAvailable property="1">
				(t.LotId in
				<iterate property="1" open="(" close=")" conjunction=",">
					#1[]#
				</iterate>
				)
			</isPropertyAvailable>
		</dynamic>
	</select>
	<select id="queryAttById" resultMap="attResult" parameterClass="Long">
		SELECT
		t.Id,
		t.LotId,
		t.Type,
		t.Description,
		t.Path,
		t.UpdateBy,
		IFNULL(u.USER_NAME, t.UpdateBy) AS UpdateByUserName,
		t.UpdateDate
		FROM
		P_Att t
		LEFT JOIN BP_USER u
		ON
		t.UpdateBy = u.USER_ID
		WHERE
		t.Id = #id#
	</select>
	<!-- 根据附件attlotId查找bean -->
	<select id="getCardPackAttIdByLotId" resultClass="java.lang.Long">
		SELECT
		Id
		FROM
		P_Att
		WHERE
		LotId = #1#
	</select>
	<insert id="insertAtt" parameterClass="attBean">
		INSERT
		INTO
		P_Att
		(
		Id,
		LotId,
		Type,
		Description,
		Path,
		UpdateBy,
		UpdateDate
		)
		VALUES
		(
		#id#,
		#lotId#,
		#type#,
		#description#,
		#path#,
		#updateBy#,
		#updateDate#
		)
	</insert>
	<!-- 修改附件表 -->
	<update id="updateAtt" parameterClass="attBean">
		UPDATE
		P_Att
		SET
		LotId = #lotId#,
		Type = #type#,
		Description = #description#,
		Path = #path#,
		UpdateBy = #updateBy#,
		UpdateDate = #updateDate#
		WHERE
		Id = #id#
	</update>
	<update id="updateForName" parameterClass="attBean">
		UPDATE
		P_Att
		SET
		UpdateBy = #updateBy#,
		UpdateDate = #updateDate#
		WHERE
		Id = #id#
	</update>

	<!-- 删除附件表 -->
	<delete id="deleteAtt" parameterClass="Long">
		DELETE FROM P_Att WHERE Id
		= #id#
	</delete>
	<select id="selectByLotId" resultClass="java.lang.Long">
		SELECT id FROM P_Att
		WHERE lotid = #1#
	</select>
</sqlMap>
